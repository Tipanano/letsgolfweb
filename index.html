<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Got The Yips?</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Got The Yips?</h1>

    <!-- Main Menu -->
    <div id="main-menu">
        <h2>Main Menu</h2>
        <!-- Mode Selection -->
        <div id="mode-selection" style="background: #eee; padding: 10px; margin-bottom: 15px; border-radius: 5px;">
            <strong>Select Mode:</strong>
            <button id="mode-btn-range">Range</button>
            <button id="mode-btn-closest">Closest to Flag</button>
            <button id="mode-btn-hole">Play Hole</button>
        </div>
        <!-- Multiplayer -->
        <div id="multiplayer-section" style="background: #e8f5e9; padding: 10px; margin-bottom: 15px; border-radius: 5px;">
            <strong>Multiplayer (Beta)</strong><br>
            <button id="test-connection-btn">Test Connection</button>
            <button id="host-game-btn">Host Game</button>
            <button id="join-game-btn">Join Game</button>
            <div id="connection-status" style="margin-top: 5px; font-size: 0.9em;">Not connected</div>
        </div>
        <!-- User Account Section -->
        <div id="user-auth-section" style="background: #eee; padding: 10px; margin-bottom: 15px; border-radius: 5px;">
            <strong>User Account</strong><br>
            <div id="player-status" style="margin-top: 8px; margin-bottom: 8px;">
                <span id="player-type-badge" style="padding: 2px 8px; border-radius: 3px; font-size: 0.85em; font-weight: bold;">GUEST</span>
                <span id="player-name" style="margin-left: 8px; font-weight: bold;">Guest_12345</span>
            </div>
            <button id="register-btn-placeholder">Sign in with Nano</button>
            <button id="profile-btn" style="display: none;">Profile & History</button>
            <button id="logout-btn" style="display: none;">Logout</button>
        </div>
        <!-- Hole Maker -->
        <div id="hole-maker-section" style="background: #e3f2fd; padding: 10px; margin-bottom: 15px; border-radius: 5px;">
            <strong>Hole Maker</strong><br>
            <button id="hole-maker-btn" onclick="window.open('holeMaker.html', '_blank')">Open Hole Maker</button>
        </div>
        <!-- Manual Placeholder -->
        <div id="manual-placeholder" style="background: #eee; padding: 10px; border-radius: 5px;">
            <strong>Game Manual</strong><br>
            <button id="manual-btn-placeholder">View Short Manual</button>
        </div>
    </div>

    <!-- Profile View (Initially Hidden) -->
    <div id="profile-view" style="display: none;">
        <button id="profile-back-btn" style="margin-bottom: 15px;">‚Üê Back to Menu</button>
        <h2>Profile</h2>

        <!-- Username Section -->
        <div style="background: #f5f5f5; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
            <h3 style="margin-top: 0;">Username</h3>
            <div id="username-display" style="margin-bottom: 10px;">
                <strong id="current-username">Loading...</strong>
            </div>
            <div id="username-edit" style="display: none;">
                <input type="text" id="username-input" placeholder="Enter new username" style="width: 60%; padding: 5px;">
                <button id="save-username-btn">Save</button>
                <button id="cancel-username-btn">Cancel</button>
            </div>
            <button id="change-username-btn">Change Username</button>
        </div>

        <!-- Game History Section -->
        <div style="background: #f5f5f5; padding: 15px; border-radius: 5px;">
            <h3 style="margin-top: 0;">Game History</h3>
            <div id="game-history-list" style="max-height: 500px; overflow-y: auto;">
                <p style="text-align: center; color: #666;">Loading game history...</p>
            </div>
        </div>
    </div>

    <!-- Game View (Initially Hidden) -->
    <div id="game-view" style="display: none;">
        <!-- Normal mode buttons (hidden in fullscreen) -->
        <button id="back-to-menu-button" style="position: absolute; top: 10px; left: 10px; z-index: 1001;">Menu</button> <!-- Adjusted position and removed inline padding -->
        <button id="switch-hole-button" style="position: absolute; top: 50px; right: 10px; z-index: 1001;">Switch Hole</button>
        <button id="reset-game-data-button" style="position: absolute; top: 10px; right: 10px; z-index: 1001; background-color: #ffdddd; border-color: #ffaaaa;">Reset Game Data</button>
        <button id="fullscreen-toggle-btn">Fullscreen</button>

        <!-- Fullscreen top bar (only visible in fullscreen mode) -->
        <div id="fullscreen-top-bar">
            <!-- Left side: Main buttons -->
            <button id="fs-menu-btn" class="fullscreen-bar-btn">Menu</button>
            <button id="fs-switch-hole-btn" class="fullscreen-bar-btn">Switch Hole</button>
            <button id="fs-help-btn" class="fullscreen-bar-btn help">
                <span id="fs-help-btn-text">How to Swing</span>
            </button>

            <!-- Spacer to push debug buttons to the right -->
            <div style="flex-grow: 1;"></div>

            <!-- Right side: Debug buttons -->
            <div id="fs-debug-buttons">
                <button id="fs-exit-fullscreen-btn" class="fullscreen-bar-btn exit">Exit Fullscreen</button>
                <button id="fs-reset-data-btn" class="fullscreen-bar-btn danger">Reset Game Data</button>
            </div>
        </div>

        <!-- Fullscreen bottom-right controls (only visible in fullscreen mode) -->
        <div id="fullscreen-controls">
            <button class="fs-control-btn" id="fs-club-btn">
                <span class="label">CLUB</span>
                <span class="value" id="fs-club-value">Select Club</span>
            </button>
            <button class="fs-control-btn" id="fs-shot-type-btn">
                <span class="label">SHOT TYPE</span>
                <span class="value" id="fs-shot-type-value">Regular</span>
            </button>
            <button class="fs-control-btn" id="fs-power-btn">
                <span class="label">POWER</span>
                <span class="value" id="fs-power-value">90%</span>
            </button>
            <button class="fs-control-btn" id="fs-stance-btn">
                <span class="label">STANCE</span>
                <span class="value" id="fs-stance-value">Center</span>
            </button>
        </div>

        <!-- Popup panels for fullscreen controls -->
        <div id="fs-club-panel" class="fs-control-panel">
            <h3>Select Club</h3>
            <div class="fs-club-grid" id="fs-club-grid">
                <!-- Club buttons will be populated by JS -->
            </div>
        </div>

        <div id="fs-shot-type-panel" class="fs-control-panel">
            <h3>Shot Type</h3>
            <div class="fs-shot-type-options">
                <button class="fs-shot-type-btn" data-type="full">Regular</button>
                <button class="fs-shot-type-btn" data-type="chip">Chip</button>
            </div>
        </div>

        <div id="fs-power-panel" class="fs-control-panel">
            <h3>Swing Power</h3>
            <div class="fs-power-slider">
                <div class="fs-power-value" id="fs-power-display">90%</div>
                <input type="range" id="fs-power-slider" min="30" max="100" value="90">
                <div style="font-size: 0.85em; opacity: 0.7; margin-top: 10px;">
                    Reducing power makes timing easier but reduces distance.
                </div>
            </div>
        </div>

        <div id="fs-stance-panel" class="fs-control-panel">
            <h3>Ball Position</h3>
            <div class="fs-stance-visual" id="fs-stance-visual">
                <div class="foot" id="fs-left-foot"></div>
                <div class="ball-marker" id="fs-ball-marker" style="top: 50%;"></div>
                <div class="foot" id="fs-right-foot"></div>
            </div>
            <div style="font-size: 0.85em; opacity: 0.7; margin-top: 10px; text-align: center;">
                Click to adjust ball position
            </div>
        </div>

        <!-- Multiplayer Shot Timer - Now using top center status display instead -->

        <!-- Closest to Flag Info Panel (Hidden by default) -->
        <div id="closest-to-flag-info" class="mode-info-panel">
        <h2>Closest to the Flag</h2>
        <p>Target Distance: <strong id="ctf-target-distance">N/A</strong> yards</p>
        <p>Shots Taken: <strong id="ctf-shots-taken">0</strong></p>
        <p>Distance from Hole: <strong id="ctf-last-distance">N/A</strong> yards</p>
        <p>Best Distance: <strong id="ctf-best-distance">N/A</strong> yards</p>
    </div>

    <!-- 2. Instructions -->
    <div id="instructions">
        <p>Press and hold 'w' key to start backswing.</p>
        <p>Press 'a' during backswing for early rotation (optional).</p>
        <p>Press 'j' during backswing OR after releasing 'w' to initiate hip rotation (REQUIRED before downswing keys).</p> <!-- UPDATED KEY -->
        <p>Release 'w' key to finish backswing (will pause at top if 'j' not pressed yet).</p> <!-- UPDATED KEY -->
        <p>After 'j' is pressed and 'w' is released, press 'a' (rotation), 'd' (arms), 'i' (wrists) to sequence the downswing.</p> <!-- UPDATED KEYS -->
    </div>

    <!-- Multiplayer Scoreboard (Fixed position top-left, below buttons) -->
    <div id="multiplayer-scoreboard" style="display: none; position: fixed; top: 80px; left: 20px; background: rgba(0, 0, 0, 0.7); color: white; padding: 15px; border-radius: 8px; font-family: 'Arial', sans-serif; z-index: 100; min-width: 250px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <h3 style="margin: 0; color: #4CAF50; font-size: 1em; font-weight: bold;">Players</h3>
            <button id="game-leave-btn" style="padding: 4px 12px; background: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.85em; font-weight: bold;">Leave</button>
        </div>
        <div id="multiplayer-player-list" style="font-size: 0.9em;">
            <!-- Player scores will be added here -->
        </div>
    </div>

    <!-- NEW Game Interface Wrapper -->
    <div id="game-interface">


        <!-- NEW Main Layout Container (Flex) -->
        <div id="main-layout">

            <!-- 4. Visuals Canvas (Moved Inside Layout) -->
            <div id="visuals-container">
                <!-- Original Canvas -->
                <canvas id="golf-canvas"></canvas>
                <!-- NEW Swing Arc Visualizer Overlay -->
                <div id="swing-arc-overlay"></div>
                <!-- NEW Overlay for In-Game Info -->
                <div id="visual-info-overlay">
                    <!-- Content will be dynamically shown/hidden based on mode -->
                    <div class="overlay-top">
                        <!-- Play Hole / CTF Top Left -->
                        <div class="overlay-top-left mode-play-hole mode-closest-to-flag">
                            <div class="overlay-text-item">Hole: <span id="overlay-hole-num">N/A</span> Par: <span id="overlay-par">N/A</span></div>
                            <div class="overlay-text-item">Shot: <span id="overlay-shot-num">N/A</span> <span id="overlay-for-score-text"></span></div>
                        </div>
                        <!-- Range Top Left -->
                        <div class="overlay-top-left mode-range">
                             <div class="overlay-text-item">Last Shot: <span id="overlay-last-shot-dist">N/A</span> yd</div>
                             <div class="overlay-text-item">Spin: <span id="overlay-back-spin">N/A</span> / <span id="overlay-side-spin">N/A</span> rpm</div>
                        </div>
                        <!-- Common Top Right -->
                        <div class="overlay-top-right">
                            <div class="overlay-text-item mode-play-hole mode-closest-to-flag">To Flag: <span id="overlay-dist-flag">N/A</span> yd</div>
                            <div class="overlay-text-item">Wind: <span id="overlay-wind">N/A</span></div>
                            <div class="overlay-text-item">Temp: <span id="overlay-temp">N/A</span></div>
                            <div class="overlay-text-item">Lie: <span id="overlay-lie">N/A</span></div>
                        </div>
                    </div>
                    <!-- NEW Top Center Status -->
                    <div id="top-center-status" class="overlay-text-item"><span id="status-text-display">Ready...</span></div>

                    <div class="overlay-bottom">
                         <!-- Play Hole Bottom Left -->
                        <div class="overlay-bottom-left mode-play-hole">
                            <div class="overlay-text-item">Player: <span id="overlay-player-name">Player 1</span></div>
                            <div class="overlay-text-item">Total: <span id="overlay-total-score">N/A</span> (<span id="overlay-position">N/A</span>)</div>
                        </div>
                        <!-- Range / CTF might not need bottom left, or could show something else -->
                         <!-- Shot Summary Widget - Progressive shot data display -->
                        <div id="shot-summary-widget" style="display: none;">
                            <!-- Impact data (shown immediately) -->
                            <div class="overlay-text-item" id="summary-clubspeed-item" style="display: none;">
                                Clubspeed: <span id="summary-clubspeed">N/A</span> mph
                            </div>
                            <div class="overlay-text-item" id="summary-ballspeed-item" style="display: none;">
                                Ball Speed: <span id="summary-ballspeed">N/A</span> mph
                            </div>
                            <div class="overlay-text-item" id="summary-smashfactor-item" style="display: none;">
                                Smash Factor: <span id="summary-smashfactor">N/A</span>
                            </div>
                            <div class="overlay-text-item" id="summary-backspin-item" style="display: none;">
                                Backspin: <span id="summary-backspin">N/A</span> rpm
                            </div>
                            <div class="overlay-text-item" id="summary-sidespin-item" style="display: none;">
                                Sidespin: <span id="summary-sidespin">N/A</span> rpm
                            </div>
                            <div class="overlay-text-item" id="summary-launch-angle-item" style="display: none;">
                                Launch: <span id="summary-launch-angle">N/A</span>¬∞
                            </div>
                            <!-- Landing data (shown when ball lands) -->
                            <div class="overlay-text-item" id="summary-peak-height-item" style="display: none;">
                                Peak: <span id="summary-peak-height">N/A</span> yd
                            </div>
                            <div class="overlay-text-item" id="summary-carry-item" style="display: none;">
                                Carry: <span id="summary-carry">N/A</span> yd
                            </div>
                            <!-- Final data (shown when ball stops) -->
                            <div class="overlay-text-item" id="summary-roll-item" style="display: none;">
                                Roll: <span id="summary-roll">N/A</span> yd
                            </div>
                            <div class="overlay-text-item" id="summary-total-item" style="display: none;">
                                Total: <span id="summary-total">N/A</span> yd
                            </div>
                            <div class="overlay-text-item" id="summary-message-item" style="display: none;">
                                <span id="summary-message">N/A</span>
                            </div>
                            <button id="show-details-button">+</button>
                        </div>
                    </div>
                </div>
            </div>

        </div> <!-- End #main-layout -->

        <!-- 3. Timing Bars (Moved below bottom-controls) -->
        <div id="timing-bars">
            <h2>Backswing Length</h2>
            <div class="timing-bar-container">
            <span class="bar-label">Length:</span>
            <div class="timing-bar backswing-bar">
                <div class="ideal-window" id="ideal-backswing-marker"></div>
                <div id="hip-initiation-marker" class="timing-marker"></div>
                <div id="post-shot-ideal-j-window-on-backswing" class="ideal-timing-feedback-backswing"></div>
                <div class="progress" id="progress-backswing"></div>
            </div>
        </div>

        <h2>Downswing Timing</h2>
        <!-- Remapped: a=Rotation, d=Arms, i=Wrists -->
        <div class="timing-bar-container">
            <span class="bar-label">Rotation (a):</span> <!-- Label stays 'a' -->
            <div class="timing-bar">
                <div class="ideal-window" id="window-a"></div> <!-- ID stays 'a' for Rotation -->
                <div class="progress" id="progress-a"></div> <!-- ID stays 'a' for Rotation -->
                <div class="marker" id="marker-a"></div>     <!-- ID stays 'a' for Rotation -->
            </div>
        </div>
        <div class="timing-bar-container">
             <span class="bar-label">Arms (d):</span> <!-- Label stays 'd' -->
            <div class="timing-bar">
                <div class="ideal-window" id="window-j"></div> <!-- ID stays 'j' for Arms -->
                <div class="progress" id="progress-j"></div> <!-- ID stays 'j' for Arms -->
                 <div class="marker" id="marker-j"></div>     <!-- ID stays 'j' for Arms -->
          </div>
        </div>
        <div class="timing-bar-container">
            <span class="bar-label">Wrists (i):</span> <!-- UPDATED KEY -->
            <div class="timing-bar">
                <div class="ideal-window" id="window-d"></div> <!-- ID stays 'd' for Wrists -->
                <div class="progress" id="progress-d"></div> <!-- ID stays 'd' for Wrists -->
                 <div class="marker" id="marker-d"></div>     <!-- ID stays 'd' for Wrists -->
            </div>
            </div>
        </div>

    </div> <!-- End #game-interface -->

    <!-- 5. Shot Result (Pop-up) -->
    <div id="shot-result">
        <h2>Shot Result</h2>
        <p><strong>Overall:</strong> <span id="result-text">Hit the ball!</span></p>
        <p>Clubhead Speed: <span id="chs-text">N/A</span> mph</p>
        <p>Ball Speed: <span id="ball-speed-text">N/A</span> mph</p>
        <p>Attack Angle: <span id="attack-angle-text">N/A</span> deg</p>
        <p>Club Path: <span id="club-path-text">N/A</span> deg</p>
        <p>Face Angle: <span id="face-angle-text">N/A</span> deg</p>
        <p>Face-to-Path: <span id="face-to-path-text">N/A</span> deg</p>
        <p>Back Spin: <span id="back-spin-text">N/A</span> rpm</p>
        <p>Side Spin: <span id="side-spin-text">N/A</span> rpm</p>
        <p>Launch Angle: <span id="launch-angle-text">N/A</span> deg</p> <!-- Added -->
        <p>Peak Height: <span id="peak-height-text">N/A</span> yd</p>
        <p>Carry Distance: <span id="carry-distance-text">N/A</span> yd</p>
        <p>Rollout Distance: <span id="result-rollout">N/A</span> yd</p> <!-- Added -->
        <p><strong>Total Distance:</strong> <span id="result-total-distance">N/A</span> yd</p> <!-- Added -->
        <button id="next-shot-button" style="display: none;">Next Shot (n)</button>
    </div>

    <!-- 6. Timing Info (Debug) -->
    <div id="timing-info">
        <h2>Timing Info (Debug)</h2>
        <p>Backswing Duration: <span id="backswing-duration">N/A</span> ms</p>
        <p>Rotation Start Offset: <span id="rotation-start-offset">N/A</span> ms</p>
        <p>Hip Initiation Offset: <span id="hip-initiation-offset">N/A</span> ms</p> <!-- Added -->
        <p>Arms Start Offset: <span id="arms-start-offset">N/A</span> ms</p>
        <p>Wrists Start Offset: <span id="wrists-start-offset">N/A</span> ms</p>
    </div>

    </div> <!-- End #game-view -->

    <!-- Multiplayer Lobby -->
    <div id="multiplayer-lobby" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border: 2px solid #4CAF50; padding: 30px; border-radius: 10px; z-index: 2000; min-width: 400px; box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
        <h2 style="margin-top: 0;">Multiplayer Lobby</h2>
        <div style="background: #f5f5f5; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
            <strong>Room Code:</strong> <span id="lobby-room-code" style="font-size: 1.5em; color: #4CAF50; font-weight: bold;">------</span>
            <button id="copy-room-code" style="margin-left: 10px; font-size: 0.9em;">Copy</button>
        </div>

        <!-- Wagering Info (only shown for wagering games) -->
        <div id="lobby-wager-info" style="display: none; background: #FFF3E0; border: 2px solid #FF9800; padding: 12px; border-radius: 5px; margin-bottom: 15px;">
            <div style="display: flex; align-items: center; gap: 10px;">
                <span style="font-size: 1.5em;">üí∞</span>
                <div>
                    <strong style="color: #F57C00;">Wagering Game</strong><br>
                    <span style="color: #666;">Entry: <strong id="lobby-wager-amount" style="color: #FF9800;">0.1 NANO</strong></span><br>
                    <span style="color: #666; font-size: 0.9em;">Winner takes all!</span>
                </div>
            </div>
        </div>

        <div style="margin-bottom: 15px;">
            <strong>Players:</strong>
            <div id="lobby-player-list" style="background: #fff; border: 1px solid #ddd; padding: 10px; margin-top: 5px; border-radius: 5px; min-height: 80px;">
                <!-- Players will be added here -->
            </div>
        </div>

        <!-- Payment Section (shown during wagering payment phase) -->
        <div id="lobby-payment-section" style="display: none; margin-bottom: 15px; background: #FFF3E0; border: 2px solid #FF9800; padding: 15px; border-radius: 5px;">
            <h3 style="margin-top: 0; color: #F57C00;">‚è≥ Waiting for Payments</h3>
            <p style="margin: 10px 0;">Send <strong id="lobby-payment-amount" style="color: #FF9800;">0.1 NANO</strong> to:</p>
            <p id="lobby-payment-address" style="font-family: monospace; font-size: 11px; word-break: break-all; background: white; padding: 8px; border-radius: 3px; margin: 10px 0;">nano_...</p>
            <button id="lobby-copy-payment-address" style="padding: 8px 16px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; margin-bottom: 10px;">Copy Address</button>
            <div id="lobby-payment-timer" style="margin-top: 10px; color: #666; font-size: 14px;">Expires in: <span id="lobby-payment-countdown">10:00</span></div>
        </div>

        <div style="margin-bottom: 15px;">
            <strong>Mode:</strong> <span id="lobby-game-mode">Closest to Flag</span>
        </div>

        <div style="text-align: center;">
            <button id="lobby-ready-btn" style="background: #4CAF50; color: white; padding: 10px 20px; font-size: 1.1em; border: none; border-radius: 5px; cursor: pointer; margin-right: 10px;">Ready</button>
            <button id="lobby-start-btn" style="background: #2196F3; color: white; padding: 10px 20px; font-size: 1.1em; border: none; border-radius: 5px; cursor: pointer; display: none;">Start Game</button>
            <button id="lobby-leave-btn" style="background: #f44336; color: white; padding: 10px 20px; font-size: 1.1em; border: none; border-radius: 5px; cursor: pointer;">Leave</button>
        </div>

        <div id="lobby-status" style="margin-top: 15px; text-align: center; color: #666; font-style: italic;">
            Waiting for players...
        </div>
    </div>

    <!-- Socket.IO Client -->
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <!-- Game Manual Modal -->
    <div id="manual-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000; justify-content: center; align-items: center; overflow-y: auto;">
        <div style="background: white; padding: 30px; border-radius: 10px; max-width: 800px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 4px 20px rgba(0,0,0,0.3); margin: 20px;">
            <h2 style="margin-top: 0; color: #1b5e20; border-bottom: 2px solid #a5d6a7; padding-bottom: 10px;">Got The Yips? - Game Manual</h2>

            <div style="margin-bottom: 25px;">
                <h3 style="color: #2e7d32; margin-bottom: 10px;">üéØ Philosophy</h3>
                <p style="line-height: 1.6; color: #37474f;">
                    This game simulates real golf - <strong>there is no "perfect" swing</strong>. Just like in real life, you can achieve great shots in many different ways. Some players prefer to overswing for extra power, others like to draw or fade the ball. The key is understanding how your timing affects the outcome.
                </p>
            </div>

            <div style="margin-bottom: 25px;">
                <h3 style="color: #2e7d32; margin-bottom: 10px;">‚õ≥ Full Swing</h3>
                <p style="line-height: 1.6; color: #37474f; margin-bottom: 15px;">
                    The full swing uses a sequence of key presses that simulate the real golf swing mechanics. Watch the swing arc visualizer on the left side of the screen for feedback.
                </p>

                <div style="background: #f5f5f5; padding: 15px; border-radius: 5px; margin-bottom: 15px;">
                    <h4 style="margin-top: 0; color: #1b5e20;">The Sequence:</h4>
                    <ol style="line-height: 1.8; color: #37474f;">
                        <li><strong>Press and hold 'w'</strong> - Start your backswing. The longer you hold, the more potential power you build.</li>
                        <li><strong>Press 'j' (during or after backswing)</strong> - Initiate hip rotation. This is your transition move.</li>
                        <li><strong>Release 'w'</strong> - Complete your backswing and begin the downswing.</li>
                        <li><strong>Press 'a'</strong> - Start body rotation.</li>
                        <li><strong>Press 'd'</strong> - Release arms.</li>
                        <li><strong>Press 'i'</strong> - Release wrists for impact.</li>
                    </ol>
                </div>

                <div style="background: #e8f5e9; padding: 15px; border-radius: 5px; margin-bottom: 15px;">
                    <h4 style="margin-top: 0; color: #1b5e20;">What Each Key Does:</h4>
                    <ul style="line-height: 1.8; color: #37474f;">
                        <li><strong>Backswing Length (w):</strong> Affects potential power. Longer = more power but harder timing windows.</li>
                        <li><strong>Hip Initiation (j):</strong> Too early or too late loses power. Ideal is about 150ms before releasing 'w'.</li>
                        <li><strong>Rotation vs Arms (a & d):</strong>
                            <ul>
                                <li>Both the TIMING and the GAP between 'a' and 'd' affect club path</li>
                                <li>Ideal: 'a' first, then 'd' about 50ms later (watch the timing bars!)</li>
                                <li>Both too early (or together) = in-to-out path (hook/draw)</li>
                                <li>Proper timing with small gap = straighter</li>
                                <li>Both late OR large gap = out-to-in path (slice/fade)</li>
                            </ul>
                        </li>
                        <li><strong>Wrist Release (i):</strong>
                            <ul>
                                <li>Early release: Adds loft, closes face, risk of "fat" contact</li>
                                <li>Late release: Removes loft, opens face, risk of "thin" contact</li>
                                <li>Affects dynamic loft more than anything else</li>
                            </ul>
                        </li>
                    </ul>
                </div>

                <div style="background: #fff3e0; padding: 15px; border-radius: 5px;">
                    <h4 style="margin-top: 0; color: #e65100;">üí° Tips:</h4>
                    <ul style="line-height: 1.8; color: #37474f;">
                        <li>Want more power? Longer backswing, but remember the timing windows scale with it.</li>
                        <li>Want straighter shots? Aim for the green zones on both 'a' and 'd' timing bars.</li>
                        <li>Hooking? You're hitting both 'a' and 'd' too early. Wait for the timing bars!</li>
                        <li>Slicing? Either both are late, or too much gap between them.</li>
                        <li>Struggle with timing? Reduce swing speed (power slider) - the windows get easier.</li>
                    </ul>
                </div>
            </div>

            <div style="margin-bottom: 25px;">
                <h3 style="color: #2e7d32; margin-bottom: 10px;">üèåÔ∏è Chip Shots</h3>
                <p style="line-height: 1.6; color: #37474f; margin-bottom: 15px;">
                    Chipping is simpler but requires finesse. Ball position is CRITICAL for chip shots.
                </p>

                <div style="background: #f5f5f5; padding: 15px; border-radius: 5px; margin-bottom: 15px;">
                    <h4 style="margin-top: 0; color: #1b5e20;">The Sequence:</h4>
                    <ol style="line-height: 1.8; color: #37474f;">
                        <li><strong>Set ball position</strong> - Click on the stance visual to adjust (forward = high soft, back = low running)</li>
                        <li><strong>Press and hold 'w'</strong> - Length determines power/distance</li>
                        <li><strong>Release 'w'</strong> - Starts downswing</li>
                        <li><strong>Press 'a'</strong> - Body rotation (affects face angle slightly)</li>
                        <li><strong>Press 'i'</strong> - Strike the ball</li>
                    </ol>
                </div>

                <div style="background: #e8f5e9; padding: 15px; border-radius: 5px;">
                    <h4 style="margin-top: 0; color: #1b5e20;">Ball Position Effects:</h4>
                    <ul style="line-height: 1.8; color: #37474f;">
                        <li><strong>Forward (toward target):</strong> Higher loft, shallower attack angle, easier to thin</li>
                        <li><strong>Back (away from target):</strong> Lower loft, steeper attack angle, easier to fat</li>
                        <li><strong>Wrist Timing (i):</strong> Must adjust based on ball position. Forward ball needs earlier 'i', back ball needs later 'i'.</li>
                        <li>Experiment with combinations: Back ball position + steep attack = low spinner. Forward ball + shallow = flop shot.</li>
                    </ul>
                </div>
            </div>

            <div style="margin-bottom: 25px;">
                <h3 style="color: #2e7d32; margin-bottom: 10px;">‚õ≥ Putting</h3>
                <p style="line-height: 1.6; color: #37474f; margin-bottom: 15px;">
                    Putting is all about distance control and timing. Unlike full swing, backswing length determines power, downswing timing determines direction.
                </p>

                <div style="background: #f5f5f5; padding: 15px; border-radius: 5px; margin-bottom: 15px;">
                    <h4 style="margin-top: 0; color: #1b5e20;">The Sequence:</h4>
                    <ol style="line-height: 1.8; color: #37474f;">
                        <li><strong>Press and hold 'w'</strong> - Length of backswing determines putt distance</li>
                        <li><strong>Release 'w'</strong> - Starts downswing (fixed tempo, always same speed)</li>
                        <li><strong>Press 'i' in the green zone</strong> - Strike the ball. Timing affects push/pull.</li>
                    </ol>
                </div>

                <div style="background: #e8f5e9; padding: 15px; border-radius: 5px;">
                    <h4 style="margin-top: 0; color: #1b5e20;">Timing:</h4>
                    <ul style="line-height: 1.8; color: #37474f;">
                        <li><strong>Too Early:</strong> Push (ball starts right of target)</li>
                        <li><strong>Perfect (in green zone):</strong> Straight putt</li>
                        <li><strong>Too Late:</strong> Pull (ball starts left of target)</li>
                        <li>Use the putting guide (spacebar during address) to see the line, but remember - greens have break!</li>
                    </ul>
                </div>
            </div>

            <div style="margin-bottom: 25px;">
                <h3 style="color: #2e7d32; margin-bottom: 10px;">üìä Understanding Feedback</h3>
                <div style="background: #f5f5f5; padding: 15px; border-radius: 5px;">
                    <ul style="line-height: 1.8; color: #37474f;">
                        <li><strong>Swing Arc Visualizer (left side):</strong> Shows your swing path in real-time. Green = backswing, Blue/Purple/Red = downswing phases.</li>
                        <li><strong>Shot Results:</strong> Shows club head speed, ball speed, launch angle, spin, and strike quality.</li>
                        <li><strong>Strike Quality:</strong> Fat, Thin, Center, High, Punch - tells you how well you contacted the ball.</li>
                        <li><strong>Club Path & Face Angle:</strong> Negative path = out-to-in (fade), Positive = in-to-out (draw). Face angle relative to path determines spin.</li>
                    </ul>
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <p style="font-style: italic; color: #666; margin-bottom: 20px;">Remember: Got the yips? Practice, experiment, and find what works for you!</p>
                <button id="close-manual-btn" style="padding: 12px 30px; background: #4CAF50; color: white; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; font-weight: bold; transition: background-color 0.3s ease;">Got It!</button>
            </div>
        </div>
    </div>

    <script type="module" src="src/main.js"></script>
    <script type="module" src="src/tools.js"></script>

    <!-- Play Hole Selection Modal -->
    <div id="play-hole-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10001; justify-content: center; align-items: center;">
        <div style="background: white; padding: 30px; border-radius: 10px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
            <h2 style="margin-top: 0; color: #333;">Select Hole</h2>

            <!-- Segmented Control for tabs -->
            <div id="hole-tabs" style="display: flex; margin-bottom: 20px; border-bottom: 2px solid #e0e0e0;">
                <button id="tab-official" class="hole-tab active" style="flex: 1; padding: 12px; border: none; background: none; cursor: pointer; font-weight: bold; color: #4CAF50; border-bottom: 3px solid #4CAF50; transition: all 0.2s;">Official Holes</button>
                <button id="tab-community" class="hole-tab" style="flex: 1; padding: 12px; border: none; background: none; cursor: pointer; color: #666; border-bottom: 3px solid transparent; transition: all 0.2s;">Community Holes</button>
                <button id="tab-yours" class="hole-tab" style="flex: 1; padding: 12px; border: none; background: none; cursor: pointer; color: #666; border-bottom: 3px solid transparent; transition: all 0.2s;">Your Holes</button>
            </div>

            <!-- Tab Content -->
            <div id="tab-content-official" class="tab-content" style="display: block; min-height: 200px;">
                <div id="official-holes-loading" style="text-align: center; padding: 40px 20px; color: #666;">
                    <div style="font-size: 1.1em; margin-bottom: 10px;">Loading official holes...</div>
                    <div style="font-size: 0.9em; color: #999;">Please wait</div>
                </div>
                <div id="official-holes-list" style="display: none; max-height: 400px; overflow-y: auto;">
                    <!-- Official holes will be listed here -->
                </div>
                <div id="official-holes-empty" style="display: none; text-align: center; padding: 60px 20px; color: #666;">
                    <p style="font-size: 1.1em; margin-bottom: 10px;">No official holes yet!</p>
                    <p style="font-size: 0.9em; color: #999;">Check back soon.</p>
                </div>
            </div>

            <div id="tab-content-community" class="tab-content" style="display: none; min-height: 200px;">
                <p style="color: #666; text-align: center; padding: 60px 20px; font-size: 1.1em;">üèóÔ∏è Coming Soon</p>
            </div>

            <div id="tab-content-yours" class="tab-content" style="display: none; min-height: 200px;">
                <div id="your-holes-loading" style="text-align: center; padding: 40px 20px; color: #666;">
                    <div style="font-size: 1.1em; margin-bottom: 10px;">Loading your holes...</div>
                    <div style="font-size: 0.9em; color: #999;">Please wait</div>
                </div>
                <div id="your-holes-list" style="display: none; max-height: 400px; overflow-y: auto;">
                    <!-- Holes will be listed here -->
                </div>
                <div id="your-holes-empty" style="display: none; text-align: center; padding: 60px 20px; color: #666;">
                    <p style="font-size: 1.1em; margin-bottom: 10px;">You haven't created any holes yet!</p>
                    <p style="font-size: 0.9em; color: #999;">Use the Hole Maker to create your first hole.</p>
                </div>
            </div>

            <button id="close-play-hole-modal" style="margin-top: 20px; padding: 12px 25px; background: #757575; color: white; border: none; border-radius: 5px; cursor: pointer; width: 100%; font-size: 1em; transition: background 0.2s;" onmouseover="this.style.background='#616161'" onmouseout="this.style.background='#757575'">Cancel</button>
        </div>
    </div>

    <!-- Nano Registration Modal -->
    <div id="nano-auth-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000; justify-content: center; align-items: center;">
        <div style="background: white; padding: 30px; border-radius: 10px; max-width: 500px; text-align: center; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
            <h2 id="nano-auth-title">Sign in with Nano</h2>
            <div id="nano-auth-content">
                <!-- Username input (registration only) -->
                <div id="username-input-section" style="margin-bottom: 20px;">
                    <label for="nano-username-input" style="display: block; margin-bottom: 8px; font-weight: bold;">Choose a username:</label>
                    <input type="text" id="nano-username-input" placeholder="ProGolfer99" style="width: 100%; padding: 10px; font-size: 16px; border: 2px solid #ddd; border-radius: 5px;" />
                    <button id="nano-username-submit" style="margin-top: 15px; padding: 12px 30px; background: #4CAF50; color: white; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; font-weight: bold;">Continue</button>
                </div>

                <!-- QR Code section (hidden initially) -->
                <div id="qr-code-section" style="display: none;">
                    <p style="margin-bottom: 15px; color: #666;">Send <strong>0.000001 NANO</strong> from your Nano wallet:</p>
                    <div id="qr-code-container" style="margin: 20px auto; padding: 20px; background: white; border: 2px solid #4CAF50; border-radius: 10px; display: inline-block;">
                        <!-- QR code will be inserted here -->
                    </div>
                    <p id="nano-address-display" style="font-family: monospace; font-size: 12px; word-break: break-all; background: #f5f5f5; padding: 10px; border-radius: 5px; margin: 15px 0;">nano_...</p>
                    <button id="copy-nano-address-btn" style="padding: 8px 20px; background: #2196F3; color: white; border: none; border-radius: 5px; font-size: 14px; cursor: pointer; font-weight: bold; margin-bottom: 15px;">Copy Address</button>
                    <p style="margin-top: 15px; color: #666; font-size: 14px;">
                        <span id="auth-status-message">Waiting for payment...</span>
                    </p>
                    <p style="color: #999; font-size: 12px; margin-top: 10px;">Your payment will be automatically refunded!</p>
                    <div id="auth-timer" style="margin-top: 10px; color: #666; font-size: 14px;">Expires in: <span id="auth-timer-countdown">5:00</span></div>
                </div>
            </div>
            <button id="nano-auth-cancel" style="margin-top: 20px; padding: 10px 25px; background: #999; color: white; border: none; border-radius: 5px; cursor: pointer;">Cancel</button>
        </div>
    </div>

    <!-- Game Type Choice Modal -->
    <div id="game-type-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000; justify-content: center; align-items: center;">
        <div style="background: white; padding: 40px; border-radius: 10px; max-width: 500px; text-align: center;">
            <h2 style="margin-bottom: 20px;">Choose Game Type</h2>
            <p style="color: #666; margin-bottom: 30px; line-height: 1.6;">
                Do you want to create a wagering game?<br><br>
                <strong>Wagering Game:</strong> All players contribute Nano to a pot. Winner takes all!<br>
                <strong>Regular Game:</strong> Play for fun, no payment required.
            </p>
            <div style="display: flex; gap: 15px; justify-content: center;">
                <button id="create-regular-game-btn" style="padding: 15px 30px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: bold; flex: 1;">Regular Game</button>
                <button id="create-wagering-game-choice-btn" style="padding: 15px 30px; background: #FF9800; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: bold; flex: 1;">Wagering Game</button>
            </div>
            <button id="cancel-game-type-btn" style="margin-top: 20px; padding: 10px 25px; background: #999; color: white; border: none; border-radius: 5px; cursor: pointer;">Cancel</button>
        </div>
    </div>

    <!-- Shot Instructions Modal -->
    <div id="shot-instructions-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10002; justify-content: center; align-items: center; overflow-y: auto;">
        <div style="background: white; padding: 25px; border-radius: 10px; max-width: 500px; width: 90%; max-height: 85vh; overflow-y: auto; box-shadow: 0 4px 20px rgba(0,0,0,0.3); margin: 20px;">
            <h2 id="shot-instructions-title" style="margin-top: 0; color: #1b5e20; border-bottom: 2px solid #a5d6a7; padding-bottom: 10px;">How to Swing</h2>

            <!-- Full Swing Instructions -->
            <div id="full-swing-instructions" style="display: none;">
                <div style="background: #f5f5f5; padding: 15px; border-radius: 5px; margin-bottom: 15px;">
                    <h4 style="margin-top: 0; color: #1b5e20;">The Sequence:</h4>
                    <ol style="line-height: 1.8; color: #37474f; padding-left: 20px;">
                        <li><strong>'w'</strong> - Hold to build backswing</li>
                        <li><strong>'j'</strong> - Press ~150ms before releasing 'w' (hip initiation)</li>
                        <li><strong>Release 'w'</strong> - Finish backswing</li>
                        <li><strong>'a'</strong> - Body rotation</li>
                        <li><strong>'d'</strong> - Arms release</li>
                        <li><strong>'i'</strong> - Wrist release (impact)</li>
                    </ol>
                </div>
                <div style="background: #fff3e0; padding: 12px; border-radius: 5px;">
                    <h4 style="margin-top: 0; color: #e65100;">Quick Tips:</h4>
                    <ul style="line-height: 1.6; color: #37474f; padding-left: 20px; margin: 0;">
                        <li><strong>Hooking?</strong> You're too early - wait for timing bars</li>
                        <li><strong>Slicing?</strong> Too late OR too big gap between 'a' and 'd'</li>
                        <li><strong>Straighter?</strong> Hit green zones on both 'a' and 'd'</li>
                        <li><strong>Easier timing:</strong> Lower power %</li>
                    </ul>
                </div>
            </div>

            <!-- Chip Instructions -->
            <div id="chip-instructions" style="display: none;">
                <div style="background: #f5f5f5; padding: 15px; border-radius: 5px; margin-bottom: 15px;">
                    <h4 style="margin-top: 0; color: #1b5e20;">The Sequence:</h4>
                    <ol style="line-height: 1.8; color: #37474f; padding-left: 20px;">
                        <li><strong>Set ball position</strong> - Forward = high/soft, Back = low/running</li>
                        <li><strong>'w'</strong> - Hold for desired distance</li>
                        <li><strong>Release 'w'</strong> - Start downswing</li>
                        <li><strong>'a'</strong> - Body rotation</li>
                        <li><strong>'i'</strong> - Strike the ball</li>
                    </ol>
                </div>
                <div style="background: #e8f5e9; padding: 12px; border-radius: 5px;">
                    <h4 style="margin-top: 0; color: #1b5e20;">Ball Position:</h4>
                    <ul style="line-height: 1.6; color: #37474f; padding-left: 20px; margin: 0;">
                        <li><strong>Forward:</strong> Higher loft, easier to thin</li>
                        <li><strong>Back:</strong> Lower loft, steeper attack, easier to fat</li>
                        <li>Adjust 'i' timing based on position!</li>
                    </ul>
                </div>
            </div>

            <!-- Putt Instructions -->
            <div id="putt-instructions" style="display: none;">
                <div style="background: #f5f5f5; padding: 15px; border-radius: 5px; margin-bottom: 15px;">
                    <h4 style="margin-top: 0; color: #1b5e20;">The Sequence:</h4>
                    <ol style="line-height: 1.8; color: #37474f; padding-left: 20px;">
                        <li><strong>'w'</strong> - Backswing length = distance</li>
                        <li><strong>Release 'w'</strong> - Start downswing</li>
                        <li><strong>'i'</strong> - Strike in green zone</li>
                    </ol>
                </div>
                <div style="background: #e8f5e9; padding: 12px; border-radius: 5px;">
                    <h4 style="margin-top: 0; color: #1b5e20;">Timing:</h4>
                    <ul style="line-height: 1.6; color: #37474f; padding-left: 20px; margin: 0;">
                        <li><strong>Too Early:</strong> Push (right)</li>
                        <li><strong>Perfect (green):</strong> Straight</li>
                        <li><strong>Too Late:</strong> Pull (left)</li>
                        <li>Press spacebar to see putting guide</li>
                    </ul>
                </div>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <button id="close-shot-instructions-btn" style="padding: 10px 25px; background: #4CAF50; color: white; border: none; border-radius: 5px; font-size: 14px; cursor: pointer; font-weight: bold;">Got It!</button>
            </div>
        </div>
    </div>

    <!-- Wagering/Escrow Modal -->
    <div id="wager-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000; justify-content: center; align-items: center;">
        <div style="background: white; padding: 20px; border-radius: 10px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; text-align: center;">
            <h2 id="wager-title" style="margin: 0 0 15px 0; font-size: 1.3em;">Wagering Game</h2>

            <!-- Wager setup (for host) -->
            <div id="wager-setup-section" style="display: none;">
                <p style="margin: 10px 0;">Create a wagering game where all players contribute Nano to a pot. Winner takes all!</p>
                <label>Wager Amount (NANO):</label>
                <input type="number" id="wager-amount-input" min="0.001" step="0.001" value="0.1" style="padding: 8px; margin: 10px 0; width: 200px;">
                <br>
                <button id="create-wager-game-btn" style="padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 10px;">Create Wagering Game</button>
                <button id="cancel-wager-setup-btn" style="padding: 10px 20px; background: #999; color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 10px; margin-left: 10px;">Cancel</button>
            </div>

            <!-- Payment section -->
            <div id="wager-payment-section" style="display: none;">
                <div style="display: flex; gap: 15px; align-items: flex-start; margin-bottom: 15px;">
                    <!-- Left: QR Code -->
                    <div style="flex-shrink: 0;">
                        <div id="wager-qr-container" style="padding: 8px; background: white; border: 2px solid #4CAF50; border-radius: 8px; width: 150px; height: 150px; display: flex; align-items: center; justify-content: center;">
                            <!-- QR code will be inserted here -->
                        </div>
                    </div>
                    <!-- Right: Address and Info -->
                    <div style="flex: 1; text-align: left;">
                        <p style="margin: 0 0 8px 0; font-size: 14px;">Send <strong id="wager-amount-display" style="color: #FF9800;">0.1 NANO</strong></p>
                        <p id="wager-escrow-address" style="font-family: monospace; font-size: 10px; word-break: break-all; background: #f5f5f5; padding: 6px; border-radius: 3px; margin: 0 0 8px 0;">nano_...</p>
                        <button id="copy-wager-address-btn" style="padding: 6px 12px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 13px; width: 100%;">Copy Address</button>
                        <div id="wager-timer" style="margin-top: 8px; color: #666; font-size: 13px;">‚è±Ô∏è <span id="wager-timer-countdown">10:00</span></div>
                    </div>
                </div>

                <div style="margin-top: 12px; padding: 12px; background: #f5f5f5; border-radius: 5px;">
                    <h3 style="margin: 0 0 8px 0; font-size: 1em;">Payment Status</h3>
                    <div id="wager-player-status-list" style="text-align: left; max-height: 120px; overflow-y: auto;">
                        <!-- Player payment status will be inserted here -->
                    </div>
                </div>

                <p style="color: #666; font-size: 13px; margin-top: 12px;">
                    <span id="wager-status-message">Waiting for all players to pay...</span>
                </p>
            </div>

            <button id="cancel-wager-btn" style="margin-top: 15px; padding: 8px 20px; background: #999; color: white; border: none; border-radius: 5px; cursor: pointer;">Cancel</button>
        </div>
    </div>

</body>
</html>
